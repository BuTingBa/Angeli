(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/classPost/classPost"],{5140:function(t,o,e){"use strict";(function(t){e("7e16"),e("921b");n(e("66fd"));var o=n(e("c72b"));function n(t){return t&&t.__esModule?t:{default:t}}t(o.default)}).call(this,e("543d")["createPage"])},"6a2d":function(t,o,e){"use strict";e.r(o);var n=e("d1bc"),s=e.n(n);for(var i in n)"default"!==i&&function(t){e.d(o,t,function(){return n[t]})}(i);o["default"]=s.a},"9c8a":function(t,o,e){"use strict";var n=function(){var t=this,o=t.$createElement;t._self._c},s=[];e.d(o,"a",function(){return n}),e.d(o,"b",function(){return s})},b4bd:function(t,o,e){},c62f:function(t,o,e){"use strict";var n=e("b4bd"),s=e.n(n);s.a},c72b:function(t,o,e){"use strict";e.r(o);var n=e("9c8a"),s=e("6a2d");for(var i in s)"default"!==i&&function(t){e.d(o,t,function(){return s[t]})}(i);e("c62f");var a=e("2877"),c=Object(a["a"])(s["default"],n["a"],n["b"],!1,null,null,null);o["default"]=c.exports},d1bc:function(t,o,e){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=s(e("26f4"));function s(t){return t&&t.__esModule?t:{default:t}}var i=function(){return e.e("components/uni-load-more").then(e.bind(null,"caa8"))},a={components:{uniLoadMore:i},data:function(){return{TabCur:0,postList:[],hotpost:[],status:"loading",Dindex:[],showAppFenxiang:!1,type:"new",page:1,classinfo:[],statusTypes:[{value:"more",text:"加载前",checked:!0},{value:"loading",text:"加载中",checked:!1},{value:"noMore",text:"我是有底线的",checked:!1}],contentText:{contentdown:"查看更多",contentrefresh:"加载中",contentnomore:"我是有底线的"}}},onLoad:function(t){this.classId=t.id,this.getClassInfo(this.classId),this.getPostList(this.classId)},methods:{appFenxiang:function(o,e){switch(o){case 0:this.showAppFenxiang=!1;break;case 1:t.setClipboardData({data:"http://share.angeli.top/?postId="+this.postid,success:function(){console.log("success")}}),console.log("复制链接");break;case 2:console.log(this.Dindex.PictureId[0]),console.log(this.Dindex.Content),console.log("http://share.angeli.top/?postId="+this.Dindex.PostsId),t.share({provider:"weixin",scene:"WXSceneSession",type:5,imageUrl:this.Dindex.PictureId[0],title:this.Dindex.Content,miniProgram:{id:"gh_a38adc10b952",path:"pages/postinfo/postinfo?id="+this.Dindex.PostsId,type:0,webUrl:"http://share.angeli.top/?postId="+this.Dindex.PostsId},success:function(t){console.log(JSON.stringify(t))},fail:function(t){console.log("fail:"+JSON.stringify(t))}});break;case 3:t.share({provider:"weixin",scene:"WXSenceTimeline",type:0,href:"http://share.angeli.top/?postId="+this.Dindex.PostsId,title:this.Dindex.Content,summary:this.Dindex.Content,imageUrl:this.Dindex.PictureId[0],success:function(t){console.log("success:"+JSON.stringify(t))},fail:function(t){console.log("fail:"+JSON.stringify(t))}});break;case 4:t.share({provider:"qq",type:1,href:"http://share.angeli.top/?postId="+this.Dindex.PostsId,summary:this.Dindex.Content,title:this.Dindex.Content,imageUrl:this.Dindex.PictureId[0],success:function(t){console.log("success:"+JSON.stringify(t))},fail:function(t){console.log("fail:"+JSON.stringify(t))}});break;default:}},getPushPost:function(){""==n.default.userinfo.Auid||null==n.default.userinfo.Auid?(t.showToast({title:"你还没有登录，请登录后再来吧",position:"bottom",icon:"none"}),setTimeout(function(){t.navigateTo({url:"../reg/reg"})},1200)):(n.default.postClass=this.classinfo,t.navigateTo({url:"../post/post"}))},getClassInfo:function(o){var e=this;t.request({method:"GET",url:"https://api.angeli.top/post.php?type=getClassInfo",data:{classId:o,token:n.default.token},header:{"content-type":"application/x-www-form-urlencoded"},success:function(o){t.hideLoading(),e.classinfo=[],e.classinfo=o.data.data,console.log(e.classinfo),e.weikong=!1,"1"!==o.data.code&&t.showToast({title:"获取话题信息失败",position:"bottom",icon:"none"}),e.$forceUpdate()}})},getpostinfo:function(o){t.navigateTo({url:"../postinfo/postinfo?id="+o})},getbieren:function(o){o==n.default.userinfo.Auid?t.navigateTo({url:"../i/i"}):t.navigateTo({url:"../i/bieren?auid="+o})},getPostList:function(o){var e=this;t.showLoading({title:"获取数据中"}),t.request({method:"GET",url:"https://api.angeli.top/post.php?type=getClassPostList",data:{page:1,count:20,classId:o,postType:this.type,token:n.default.token},header:{"content-type":"application/x-www-form-urlencoded"},success:function(o){t.hideLoading(),e.postList=[],console.log("————————————帖子列表——————————"),"new"==e.type?e.postList=o.data.data:e.hotpost=o.data.data,console.log(e.postList),e.weikong=!1,"1"!==o.data.code&&t.showToast({title:"获取帖子失败，建议重启",position:"bottom",icon:"none"}),0==o.data.data&&(e.weikong=!0)},complete:function(){t.hideLoading()}})},showImage:function(o,e){var n=o[e];t.previewImage({current:e,urls:o,longPressActions:{itemList:["保存图片"],success:function(o){t.downloadFile({url:n,success:function(o){console.log(o),200===o.statusCode?t.saveImageToPhotosAlbum({filePath:o.tempFilePath,success:function(){t.showToast({title:"已保存",position:"bottom",icon:"none"})}}):t.showToast({title:"保存失败",position:"bottom",icon:"none"})}})},fail:function(t){console.log(t.errMsg)}}})},caidan:function(o){console.log(o),this.Dindex=o,o.AuthorId==n.default.userinfo.Auid?this.menuList=["分享给朋友","举报","删除帖子"]:this.menuList=["分享给朋友","举报"],t.showActionSheet({itemList:this.menuList,success:function(t){switch(t.tapIndex){case 0:this.showAppFenxiang=!0;break;case 1:break;case 2:break;case 3:break;default:}},fail:function(t){console.log(t.errMsg)}})},EndLoding:function(o){var e=this;this.page++,console.log(this.page),t.request({method:"GET",url:"https://api.angeli.top/post.php?type=getClassPostList",data:{page:1,count:20,classId:classId,postType:this.type,token:n.default.token},header:{"content-type":"application/x-www-form-urlencoded"},success:function(o){t.hideLoading(),e.postList=[],console.log("————————————帖子列表——————————"),"new"==e.type?e.postList=o.data.data:e.hotpost=o.data.data,console.log(e.postList),e.weikong=!1,"1"!==o.data.code&&t.showToast({title:"获取帖子失败，建议重启",position:"bottom",icon:"none"}),0==o.data.data&&(e.weikong=!0)},complete:function(){t.hideLoading()}})},Like:function(o,e,s,i,a){var c=this;if(""==n.default.userinfo.Auid||null==n.default.userinfo.Auid)return t.showToast({title:"你还没有登录，请登录后再来吧",position:"bottom",icon:"none"}),void setTimeout(function(){t.navigateTo({url:"../reg/reg"})},1200);if(e!=n.default.userinfo.Auid){if(!0===s)var u="del";else u="add";t.request({method:"GET",url:"https://api.angeli.top/post.php?type=Like",data:{fuid:e,postid:o,mode:u,token:n.default.token},header:{"content-type":"application/x-www-form-urlencoded",system:n.default.system},success:function(o){"1"==o.data.code?("add"==u?("new"==c.type?(c.postList[i].ZhongcaoCount=Number(a)+1,c.postList[i].Give=!0):(c.hotpost[i].ZhongcaoCount=Number(a)+1,c.hotpost[i].Give=!0),t.showToast({title:"种草成功！",position:"bottom",icon:"none"})):("new"==c.type?(c.postList[i].ZhongcaoCount=Number(a)-1,c.postList[i].Give=!1):(c.hotpost[i].ZhongcaoCount=Number(a)-1,c.hotpost[i].Give=!1),t.showToast({title:"取消种草成功！",position:"bottom",icon:"none"})),c.$forceUpdate()):t.showToast({title:"种草失败！",position:"bottom",icon:"none"})},complete:function(){}})}else t.showToast({title:"不能给自己种草",position:"bottom",icon:"none"})},tabSelect:function(t){this.TabCur=t,this.type=0==t?"new":"hot",this.getPostList(this.classId)}}};o.default=a}).call(this,e("543d")["default"])}},[["5140","common/runtime","common/vendor"]]]);